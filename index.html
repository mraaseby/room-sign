<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Room Schedule</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#000; color:#fff; }
    .wrap { display:grid; grid-template-columns: 2fr 1fr; min-height:100vh; }
    .main { padding:32px; }
    .side { background:#ddd; color:#000; padding:20px; }
    h1 { margin:0 0 8px 0; font-size:28px; opacity:.9; }
    .day { margin-top:18px; }
    .event { padding:14px 0; border-bottom:1px solid rgba(255,255,255,.15); }
    .time { font-size:14px; opacity:.8; }
    .title { font-size:24px; font-weight:700; margin-top:4px; }
    .smallEvent { padding:10px 0; border-bottom:1px solid rgba(0,0,0,.15); }
    .qr { margin-top:18px; background:#fff; padding:10px; display:inline-block; border-radius:8px; }
    .note { font-size:12px; opacity:.75; margin-top:10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="main">
      <h1 id="roomName">Room Schedule</h1>

      <div class="day">
        <h2>Today</h2>
        <div id="today"></div>
      </div>

      <div class="day">
        <h2>Tomorrow</h2>
        <div id="tomorrow"></div>
      </div>

      <div class="note">Auto-refreshes every 5 minutes.</div>
    </div>

    <div class="side">
      <h2>Book this room</h2>
      <div class="qr">
        <img id="qrImg" alt="QR" />
      </div>
      <div style="margin-top:10px; font-size:14px;" id="bookUrlText"></div>

      <h3 style="margin-top:22px;">Upcoming</h3>
      <div id="upcoming"></div>
    </div>
  </div>

<script>
  // ======= CONFIG =======
  const ROOM_NAME = "Room Pacific";
  const BOOKING_URL = "PASTE_YOUR_BOOKING_PAGE_LINK_HERE";
  const APPS_SCRIPT_PROXY = "https://script.google.com/macros/s/AKfycbwj8qKwz2oZTuXdHWpJexroYDSM-BoZUP0h4FriaBvgB2FYDLP3l8j_2UQQ_wp57lXo/exec"; // https://script.google.com/macros/s/.../exec
  const ICS_URL = "https://calendar.google.com/calendar/u/0?cid=Y180OTRhYTA3ODBmZDE3NTNhN2YwMjM5YTMwY2M3ZGEwMGI4ZDA1MDk5MTEzY2U3Nzk5MDc4NDQ1YTliYWNmYTYyQGdyb3VwLmNhbGVuZGFyLmdvb2dsZS5jb20";
 
  // ======================

  document.getElementById("roomName").textContent = ROOM_NAME;

  // QR via Google's chart endpoint (simple + no libraries)
  const qr = document.getElementById("qrImg");
  const qrSize = "220x220";
  qr.src = "https://chart.googleapis.com/chart?cht=qr&chs=" + qrSize + "&chl=" + encodeURIComponent(BOOKING_URL);
  document.getElementById("bookUrlText").textContent = BOOKING_URL;

  function parseIcsDate(s) {
    // Handles basic formats like 20251212T150000Z or 20251212T150000
    if (!s) return null;
    const z = s.endsWith("Z");
    const clean = z ? s.slice(0, -1) : s;
    const y = clean.slice(0,4), mo = clean.slice(4,6), d = clean.slice(6,8);
    const hh = clean.slice(9,11) || "00", mm = clean.slice(11,13) || "00", ss = clean.slice(13,15) || "00";
    const iso = `${y}-${mo}-${d}T${hh}:${mm}:${ss}${z ? "Z" : ""}`;
    return new Date(iso);
  }

  function fmtTime(d) {
    return d.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
  }

  function sameDay(a, b) {
    return a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate();
  }

  async function load() {
    const url = APPS_SCRIPT_PROXY + "?ics=" + encodeURIComponent(ICS_URL);
    const res = await fetch(url);
    const data = await res.json();

    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const tomorrow = new Date(today); tomorrow.setDate(today.getDate()+1);

    const parsed = (data.events || []).map(e => {
      const start = parseIcsDate(e.dtstart);
      const end = parseIcsDate(e.dtend);
      return { start, end, summary: e.summary || "Reserved" };
    }).filter(e => e.start && e.end)
      .sort((a,b)=>a.start-b.start);

    const todays = parsed.filter(e => sameDay(e.start, today));
    const tomorrows = parsed.filter(e => sameDay(e.start, tomorrow));
    const upcoming = parsed.filter(e => e.end > now).slice(0, 5);

    const renderList = (el, list, small=false) => {
      el.innerHTML = list.length ? "" : "<div style='opacity:.7'>No reservations</div>";
      for (const e of list) {
        const div = document.createElement("div");
        div.className = small ? "smallEvent" : "event";
        div.innerHTML = `
          <div class="time">${fmtTime(e.start)} â€“ ${fmtTime(e.end)}</div>
          <div class="${small ? "" : "title"}">${e.summary}</div>
        `;
        el.appendChild(div);
      }
    };

    renderList(document.getElementById("today"), todays);
    renderList(document.getElementById("tomorrow"), tomorrows);
    renderList(document.getElementById("upcoming"), upcoming, true);
  }

  load();
  setInterval(load, 5 * 60 * 1000);
</script>
</body>
</html>
